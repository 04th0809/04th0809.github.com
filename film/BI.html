<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	<title></title>
    <link rel="stylesheet" href="assets/css/index.css">
</head>
<body class="pg_bi">
    <div class="banner"><img src="assets/img/banner.jpg" alt="" width="100%"></div>
    <div class="container">
        <!--搜索-->
        <div class="searchBox">
            <form>
                <div class="input-group">
                    <div class="input-cont">
                        <input type="text" placeholder="输入电影名称，看预告片精彩分析" class="form-control" id="search">
                    </div>
                    <span class="input-group-btn">
                        <button type="button" class="btn btn-sear"><i class="m-icon-magnifier"></i></button>
                    </span>
                </div>
            </form>
            <div class="suggestion" id="suggestion" style="display:none">
                <ul>
                    <li>奔跑吧</li>
                    <li>奔跑吧</li>
                    <li>奔跑吧</li>
                </ul>
            </div>
        </div>
        <div class="film_brief clearfixed">
            <div class="p">
                <img src="http://p0.meituan.net/165.220/movie/a4f309b98a8e02bff70982d6118de3591478900.jpg" width="100%">
            </div>
            <div class="t">
                <dl>
                    <dt>重返20岁</dt>
                    <dd>导演：陈正道</dd>
                    <dd>主演：杨子姗，归亚蕾，陈柏霖，鹿晗</dd>
                    <dd>上映日期：1月10日</dd>
                    <dd>播放总量：2,345万</dd>
                </dl>
            </div>
        </div>
        <!--tit-->
        <div class="titBox">
            <h2>预告片播放量分析</h2>
            <div class="lk_btn back_home_btn"></div>
        </div>
        <!--排行榜-->
        <div class="frame_cont">
            <!--tab-->
            <div class="r_tab">
                <ul>
                    <li class="cur" data-tab-href="#list1">7天趋势</li>
                    <li data-tab-href="#list2">渠道分布</li>
                </ul>
            </div>
            <div class="list_bd">
                <div data-tab-id="list1" class="tab-content cur">
                    <div id="main" class="chart"></div>
                    <div class="data-compare">
                        <div class="tit">同期上映</div>
                        <div class="compare_list clearfixed">
                            <ul id="compare1">
                                <li><em></em>三更车库</li>
                                <li><em></em>战狼</li>
                                <li><em></em>白幽灵传奇之绝命逃亡</li>
                                <li><em></em>暴疯语</li>
                                <li><em></em>冲锋车</li>
                                <li><em></em>特功明星</li>
                                <li><em></em>江南1970</li>
                                <li><em></em>重生恋人</li>
                                <li><em></em>超能查派</li>
                                <li><em></em>技术者们</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div data-tab-id="list2" class="tab-content">
                    <div id="main2" class="chart"></div>
                    <div class="data-compare">
                        <div class="tit">同期上映</div>
                        <div class="compare_list clearfixed">
                            <ul id="compare2">
                                <li><em></em>三更车库</li>
                                <li><em></em>战狼</li>
                                <li><em></em>白幽灵传奇之绝命逃亡</li>
                                <li><em></em>暴疯语</li>
                                <li><em></em>冲锋车</li>
                                <li><em></em>特功明星</li>
                                <li><em></em>江南1970</li>
                                <li><em></em>重生恋人</li>
                                <li><em></em>超能查派</li>
                                <li><em></em>技术者们</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="backTop"></div>
    <script src="assets/js/zepto.min.js"></script>
    <script src="assets/js/touch.js"></script>
    <script src="assets/js/fx.js"></script>
    <script src="assets/js/echarts.js"></script>
    <script type="text/javascript">
        var colors = ['#ff6600','#37536c','#319d4a','#c82a2a','#d89a14','#be1dc8','#5d32b4','#808000','#88c322','#57b2e1','#828282'];
        var data_x1 = ['2/1','2/2','2/3','2/4','2/5','2/6','2/7'];
        var data_x2 = ['优酷','土豆','腾讯','搜狐','乐视','其他'];
        //0 当前电影数据, 1-10同期数据
        var data_y1 = {
            0:[317686,225430,108217,90847,95382,89731,357732],
            1:[90847,95382,89731,357732,317686,225430,108217],
            2:[90847,95382,89731,317686,225430,108217,357732],
            3:[317686,225430,208217,90847,95382,89731,357732],
            4:[90847,95382,89431,357732,337686,225430,108217],
            5:[317686,225430,158217,90847,55382,89731,357732],
            6:[90847,95382,99761,357732,117686,225430,108217],
            7:[317686,225430,908217,90847,11382,89731,357732],
            8:[90847,95382,29731,357732,117686,225430,108217],
            9:[317686,225430,808217,90847,95382,89731,357732],
            10:[90847,95382,99731,357732,317686,225430,108217]
        };
        var data_y2 = {
            0:[42000, 1400, 8000, 23000, 2500, 100],
            1:[32, 4.9, 7.0, 23.2, 25.6, 1.7],
            2:[12, 14.9, 9.0, 53.2, 5.6, 1.7],
            3:[32, 4.9, 7.0, 23.2, 25.6, 1.7],
            4:[12, 14.9, 9.0, 53.2, 5.6, 1.7],
            5:[12, 14.9, 9.0, 53.2, 5.6, 1.7],
            6:[32, 4.9, 7.0, 23.2, 25.6, 1.7],
            7:[12, 14.9, 9.0, 53.2, 5.6, 1.7],
            8:[32, 4.9, 7.0, 23.2, 25.6, 1.7],
            9:[12, 14.9, 29.0, 3.2, 5.6, 1.7],
            10:[2, 14.9, 9.0, 53.2, 5.6, 1.7]
        }
        var tit = '重返20岁';
    </script>
    <script src="assets/js/common.js"></script>
	<script>
		// 路径配置
		require.config({
			paths: {
				echarts: './assets/js'
			}
		});

		// 使用
		require(
			[
				'echarts',
				'echarts/chart/line', // 使用柱状图就加载bar模块，按需加载
				'echarts/chart/bar'
			],
			function (ec) {
				trend(ec)
			}
		);
        // tab切换初始化charts
        var flagInit = false;
        function tabChange(id){
            if(id=='list2'){
                if(!flagInit){
                    // 为echarts对象加载数据
                    channel();
                    flagInit = true;
                }
            }
        }

		// 7天趋势
		function trend(ec){
			// 基于准备好的dom，初始化echarts图表
			var myChart = ec.init(document.getElementById('main'));

			var option = {
				tooltip: {
					trigger: 'axis'
				},
				legend: {
					data: (function(){
						   var arr = [];
						   //var d = {name:tit, textStyle:{color:colors[0]}}
						   arr.push(tit)
						   return arr;
					})(),
					itemWidth:13,
					itemHeight:13,
					selectedMode:false,
					x:'right',
					y:15
				},
				color:colors,
				grid:{
					x:50,
					y:40,
					x2:30,
					y2:40
				},
				xAxis : [
					{
						type : 'category',
						boundaryGap : false,
						'axisLabel':{
							'textStyle': {
								fontSize: '12',
								fontFamily: 'Microsoft YaHei'
							}
						},
						axisLine:{
							lineStyle:{color:'#0091cb',width:1}
						},
						splitLine:{lineStyle:{color:['#f0f0f0']}},
						data : data_x1
					}
				],
				yAxis : [
					{
						type : 'value',
						'axisLabel':{
							'textStyle': {
								fontSize: '13',
								fontFamily: 'Arial'
							},
							formatter:function(value){
								if(value>10000){
									return value/10000+'万'
								}else{
									return value
								}
							}
						},
						splitLine:{lineStyle:{color:['#f0f0f0']}},
						axisLine:{lineStyle:{color:'#0091cb',width:1}}
					}
				],
				series : [
					{
						"name":tit,
						"type":"line",
						symbol:'emptyCircle',
						symbolSize:4,
						data:data_y1[0]
					}
				]
			};
			// 为echarts对象加载数据
			myChart.setOption(option);

			// 对比
			$('#compare1').bind(zClick,function(e){
				var tar = e.target, $tar = $(tar), $li, $em, idx;
				if(!$tar.closest('li').length){return false}
				$li = $tar.closest('li');
				$em = $li.find('em');
				idx = $li.index();
				var val = $li.text();
				var legend = myChart.chart['line'].component.legend;
				if($li.hasClass('cur')){
					$li.removeClass('cur');
					$em.css({'background-color':''})
					legend.setSelected(val,false);
				}else{
					$li.addClass('cur');
					$em.css({'background-color':colors[idx+1]})
					var added = false,len;
					len = option.series.length;
					while (len--) {
						if (option.series[len].name == val) {
							// 已经添加
							added = true;
							break;
						}
					}
					if(!added){
						option.series.push({
							"name": val,
							"type":"line",
							'symbol':'emptyCircle',
							'symbolSize':4,
							'itemStyle': {
								normal: {
									color:colors[idx+1]
								}
							},
							data:data_y1[idx+1]
						})
						myChart.setOption(option);
					}else{
						legend.setSelected(val,true);
					}
				}
			})
		}

		// 渠道分布
		function channel(){
			var option1 = {
				tooltip : {
					trigger: 'axis'
				},
				legend: {
					data: (function(){
						   var arr = [];
						   arr.push(tit)
						   return arr;
					})(),
					itemWidth:13,
					itemHeight:13,
					selectedMode:false,
					x:'right',
					y:15
				},
				color:colors,
				grid:{
					x:50,
					y:40,
					x2:30,
					y2:40
				},
				xAxis : [
					{
						type : 'category',
						'axisLabel':{
							'textStyle': {
								fontSize: '12',
								fontFamily: 'Microsoft YaHei'
							}
						},
						axisLine:{
							lineStyle:{color:'#0091cb',width:1}
						},
						splitLine:{lineStyle:{color:['#f0f0f0']}},
						data : data_x2
					}
				],
				yAxis : [
					{
						type : 'value',
						'axisLabel':{
							'textStyle': {
								fontSize: '13',
								fontFamily: 'Arial'
							},
							formatter:function(value){
								if(value>10000){
									return value/10000+'万'
								}else{
									return value
								}
							}
						},
						splitLine:{lineStyle:{color:['#f0f0f0']}},
						axisLine:{lineStyle:{color:'#0091cb',width:1}}
					}
				],
				series : [
					{
						name:tit,
						type:'bar',
						data:data_y2[0],
						barGap:'4',
						barCategoryGap:'30%',
						markPoint : {
							data : [
								{type : 'max', name: '最大值'}
							]
						}
					}
				]
			};

			var myChartBar= require('echarts').init(document.getElementById('main2'));
			myChartBar.setOption(option1);

			// 对比
			$('#compare2').bind(zClick,function(e){
				var tar = e.target, $tar = $(tar), $li, $em, idx;
				if(!$tar.closest('li').length){return false}
				$li = $tar.closest('li');
				$em = $li.find('em');
				idx = $li.index();
				var val = $li.text();
				var legend = myChartBar.chart['bar'].component.legend;
				if($li.hasClass('cur')){
					$li.removeClass('cur');
					$em.css({'background-color':''})
					legend.setSelected(val,false);
				}else{
					$li.addClass('cur');
					$em.css({'background-color':colors[idx+1]})
					var added = false,len;
					len = option1.series.length;
					while (len--) {
						if (option1.series[len].name == val) {
							// 已经添加
							added = true;
							break;
						}
					}
					if(!added){
						option1.series.push({
							"name": val,
							"type":"bar",
							'symbol':'emptyCircle',
							'symbolSize':4,
							'itemStyle': {
								normal: {
									color:colors[idx+1]
								}
							},
							"data": data_y2[idx+1],
							'markPoint' : {
								data : [
									{type : 'max', name: '最大值'}
								],
								'itemStyle': {
									normal: {
										color:colors[idx+1]
									}
								}
							}
						})
						myChartBar.setOption(option1);
					}else{
						legend.setSelected(val,true);
					}
				}
			})
		}

	</script>
</body>
</html>
